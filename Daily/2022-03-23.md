# blog

1. hexo generate ç¯å¢ƒé—®é¢˜
    1. hexo æœ¬èº«ä¸èƒ½ä»å‘½ä»¤è¡Œè®¾ç½®å˜é‡ï¼Œæ”¹å˜ path
    2. æ€è€ƒï¼š éœ€è¦ä»æ¨¡æ¿æŒ‰ç¯å¢ƒæ„å»ºï¼Œå‡ ç§å·¥å…·ï¼š
        - ansibleï¼šæœ€ç›´æ¥ï¼Œç„¶è€Œ windows ä¸èƒ½å®‰è£… ansible ï¼Œæ”¾å¼ƒï¼ˆä½¿ç”¨ ansible ä¹Ÿå¤ªè¿‡å°é¢˜å¤§åšï¼‰
        - jinja2ï¼šjinja æœ¬èº«æ²¡æœ‰ç¬¬ä¸€æ–¹çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œä¸æƒ³å†™ python ï¼Œæ”¾å¼ƒ
        - golang templateï¼šgithub action å¯ä»¥ä»å‘½ä»¤è¡Œè¿è¡Œ go è„šæœ¬ï¼ŒåŸºæœ¬æ²¡æœ‰ä¾èµ–ï¼Œä¸éœ€è¦å®‰è£…å…¶ä»–åŒ…ï¼Œä¸éœ€è¦åšæ¨¡å—ï¼ˆæ‡’ï¼‰
            - golang template çš„ name è¦æ˜¯ file name
                ```golang
                name := path.Base(*tmpl)
                t := template.Must(template.New(name).ParseFiles(*tmpl))
                err = t.Execute(os.Stdout, config)
                if err != nil {
                    log.Fatal(err)
                }
                ```
            - github workflow å¦‚ä¸‹
                ```yaml            
                - name: Use Go 1.16
                    uses: actions/setup-go@v1
                    with:
                    go-version: '1.16.1'
                
                - name: generate config
                    run: go run ./genconfig/main.go --env=gh-pages > _config.yml

                ```
            - windows ä¸‹ ç®¡é“å‘½ä»¤ç¬¦æœ‰é—®é¢˜ï¼ˆå¸¦ BOMï¼‰ï¼Œmake å‘½ä»¤ä¹Ÿç”¨ä¸äº†ï¼Œä½†æ‡’å¾—è§£å†³
2. åŸºç¡€è®¾æ–½æ€ä¹ˆå®šä¹‰
    1. è®¾æ–½æœ‰ï¼š
        1. S3
        2. CloudFront
        3. Route53
        4. Certificate Manager
    2. ä½¿ç”¨å•ç‹¬çš„åº“å®šä¹‰ï¼ˆè€ƒè™‘åˆ°ä»¥åè¿˜è¦ç•™ cloudFront -> Backend çš„é€”å¾„ï¼‰
    3. trigger -> Github æœ‰ç‚¹æ…¢
3. ä¸Šä¼ åˆ° s3
    1. é¦–å…ˆç›´æ¥å‘½ä»¤è¡Œå°è¯•ä»¥ä¸‹
        ```
        aws s3 cp ./public s3://test.okami-ryo.xyz/ --recursive --region=ap-northeast-1
        ```
        æˆåŠŸ
        ä½†ï¼Œurl è®¿é—® https://test.okami-ryo.xyz è¿”å› 307 ä¸ 301 ï¼Œé¡ºåºå¦‚ä¸‹ï¼š
        ![[2022-03-24-02-04-19.png]]
        åŸå› å¦‚ä¸‹ï¼š
        - s3 æœ‰åœ°åŒºè®¿é—® url ä¸å…¨çƒè®¿é—®url
        - s3 æ–°å»ºæ—¶ï¼Œå…¨çƒè®¿é—®éœ€è¦ 24h æ‰èƒ½å»ºç«‹
        - CloudFront é“¾æ¥åˆ° s3 æ˜¯ä½¿ç”¨ å…¨çƒè®¿é—®
        - CloudFront åœ¨ us-east-1 ï¼Œå…¨çƒè®¿é—®è®¿é—®ä¸åˆ°å…¶ä»–åœ°åŒºçš„ s3

        é€”ä¸­åˆè¯•äº†ä¸€ä¸‹ï¼Œ `index.html` å’Œtsç­‰æ–‡ä»¶èƒ½ç›´æ¥è®¿é—®äº†ï¼Œä½†è®¿é—®æ–‡ç« åˆæ˜¾ç¤ºé”™è¯¯
    2. éš”ä¸€å¤©åæ­£å¸¸è®¿é—®ï¼Œä½†è·³è½¬ä¸æ­£å¸¸ï¼Œå¯èƒ½æ˜¯é‡åˆ° 403 è‡ªåŠ¨è·³è½¬åˆ° main å¯¼è‡´ï¼ˆ hexo ä¸æ˜¯ SPA ï¼Œä½†ç›´æ¥ç”¨äº† SPA çš„æ¨¡æ¿ï¼‰
        æŸ¥ s3 -> åŸå› ï¼š
        1. è®¾ç½®äº† 403 error è¿”å›ï¼Œæ‰€æœ‰ 403 éƒ½ä¼šä¿æŒ url è¿”å› index 200 (ä¸æ˜¯ SPA ï¼Œå…¶å®è¿™ä¸€æ­¥ä¸éœ€è¦)
        2. cloudFront æ²¡æœ‰å»æ‰ index.html çš„åŠŸèƒ½ï¼Œåªä¼šå¿ å®çš„è¿”å›æºçš„å†…å®¹
        3. s3 æœ‰å»æ‰ index.html çš„åŠŸèƒ½ï¼Œä»…åœ¨ webhosted å¼€å¯çš„æ—¶å€™é€‚ç”¨ï¼ˆå…¶å®å·²å¼€å¯ï¼Œä½†ç°åœ¨æ²¡æœ‰å¼€å¯å…¬æœ‰è®¿é—®æ‰€ä»¥æ— æ³•éªŒè¯ï¼‰
        4. cloudFront ç›´æ¥ç”¨ s3 arn è®¿é—®æºï¼Œèµ° aws å†…éƒ¨ç½‘ç»œï¼Œæ²¡æœ‰è§¦å‘ website hosting
        è§£å†³æ–¹æ³•ï¼š
        1. s3 å¼€å¯website hosting ï¼Œå…è®¸ cloudFront è®¿é—®ï¼Œ å°†ç´¢å¼•æ–‡æ¡£å®šä¹‰ä¸º index.html ï¼Œ cloudFront ä¸ç”¨ arn è€Œæ˜¯ç›´æ¥é€šè¿‡ webEndpoint è®¿é—®(ä¸èƒ½ä½¿ç”¨ OIA)
        2. ä½¿ç”¨ lambda@Edge ï¼ˆAWS æ¨èï¼‰, å¯ä»¥åŒæ—¶ä½¿ç”¨ OAI <- å…ˆå°è¯•ä½¿ç”¨è¿™ä¸ª
            [å‚è€ƒæ–‡çŒ®](https://aws.amazon.com/blogs/compute/implementing-default-directory-indexes-in-amazon-s3-backed-amazon-cloudfront-origins-using-lambdaedge/)
            > If you implement CloudFront in front of S3, you can achieve this by using an OAI. However, in order to do this, you cannot use the HTTP endpoint that is exposed by S3â€™s static website hosting feature. Instead, CloudFront must use the S3 REST endpoint to fetch content from your origin so that the request can be authenticated using the OAI. This presents some challenges in that the REST endpoint does not support redirection to a default index page.

            > CloudFront does allow you to specify a default root object (index.html), but it only works on the root of the website (such as http://www.example.com > http://www.example.com/index.html). It does not work on any subdirectory (such as http://www.example.com/about/). If you were to attempt to request this URL through CloudFront, CloudFront would do a S3 GetObject API call against a key that does not exist.


        3. æ‰“å¼€ s3 å‚¨å­˜æ¡¶æ—¥å¿—è®¾å®šï¼Œç»™ç›®æ ‡æ¡¶ logging.s3.amazonaws.com è®¿é—®æƒé™
    3. å°è¯•æ‰‹åŠ¨å»ºç«‹ Lambda@Edge ï¼ˆ æ–°å»º Lambda ï¼Œè®¾ç½®äº‹ä»¶æºä¸º Cloud Front ï¼ˆæŒ‰æç¤ºé…ç½® Role æƒé™åˆ° Edge ï¼‰ï¼Œç²˜è´´ Code ï¼ŒDeploy
        1. è®¿é—® / ç»“å°¾ url ï¼Œæ˜¾ç¤ºå¦‚ä¸‹ï¼š
        2. å¯èƒ½æ˜¯ deploy code æ—¶æ²¡æœ‰ deploy åˆ° Lambda@Edge ï¼Œå†è¯•
        3. å¥½äº†ï¼
    4. ä¸‹ä¸€æ­¥ï¼š
        1. æ„å»ºåè‡ªåŠ¨ä¸Šä¼ åˆ° s3 çš„ github workflow
        2. è€ƒè™‘ lambda@Edge ç”¨ pulumi ä»£ç åŒ–


å‚è€ƒé˜…è¯»ï¼š
- Cloud Frontï¼š[æŒ‡å®šé»˜è®¤æ ¹å¯¹è±¡](https://docs.aws.amazon.com/zh_cn/AmazonCloudFront/latest/DeveloperGuide/DefaultRootObject.html)ï¼š
    ä»¥ä¸‹ç¤ºä¾‹è¯´æ˜äº†é»˜è®¤æ ¹å¯¹è±¡çš„å·¥ä½œæ–¹å¼ã€‚å‡å®šä»¥ä¸‹è¯·æ±‚æŒ‡å‘å¯¹è±¡ image.jpgï¼š
    ```
    https://d111111abcdef8.cloudfront.net/image.jpg
    ```
    ç›¸åï¼Œä»¥ä¸‹è¯·æ±‚æŒ‡å‘ç›¸åŒåˆ†é…çš„æ ¹ URL è€Œä¸æ˜¯ç‰¹å®šçš„å¯¹è±¡ï¼Œå¦‚ç¬¬ä¸€ä¸ªç¤ºä¾‹ä¸­æ‰€è¿°ï¼š
    ```
    https://d111111abcdef8.cloudfront.net/
    ```
    å½“æ‚¨å®šä¹‰é»˜è®¤æ ¹å¯¹è±¡æ—¶ï¼Œè°ƒç”¨åˆ†é…çš„æ ¹çš„æœ€ç»ˆç”¨æˆ·è¯·æ±‚è¿”å›é»˜è®¤æ ¹å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æŒ‡å®šæ–‡ä»¶ index.html ä½œä¸ºæ‚¨çš„é»˜è®¤æ ¹å¯¹è±¡ï¼Œè¯·æ±‚ï¼š
    ```
    https://d111111abcdef8.cloudfront.net/
    ```
    è¿”å›å€¼:
    ```
    https://d111111abcdef8.cloudfront.net/index.html
    ```
    ä½†æ˜¯ï¼Œå¦‚æœæ‚¨å®šä¹‰é»˜è®¤æ ¹å¯¹è±¡ï¼Œæœ€ç»ˆç”¨æˆ·å¯¹åˆ†é…çš„å­ç›®å½•çš„è¯·æ±‚ä¸è¿”å›é»˜è®¤æ ¹å¯¹è±¡ã€‚ä¾‹å¦‚ï¼Œå‡è®¾ index.html æ˜¯æ‚¨çš„é»˜è®¤æ ¹å¯¹è±¡ä¸” CloudFront æ¥æ”¶æœ€ç»ˆç”¨æˆ·å¯¹ CloudFront åˆ†é…ä¸‹çš„ install ç›®å½•çš„è¯·æ±‚ï¼š
    ```
    https://d111111abcdef8.cloudfront.net/install/
    ```
    CloudFront ä¸ä¼šè¿”å›é»˜è®¤æ ¹å¯¹è±¡ï¼Œå³ä½¿ index.html çš„å‰¯æœ¬å‡ºç°åœ¨installç›®å½•ä¸­ã€‚

    å¦‚æœæ‚¨å°†è‡ªå·±çš„åˆ†é…é…ç½®ä¸ºå…è®¸ CloudFront æ”¯æŒçš„æ‰€æœ‰ HTTP æ–¹æ³•ï¼Œåˆ™é»˜è®¤æ ¹å¯¹è±¡é€‚ç”¨äºæ‰€æœ‰æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨çš„é»˜è®¤æ ¹å¯¹è±¡ä¸º index.php å¹¶ä¸”æ‚¨ç¼–å†™åº”ç”¨ç¨‹åºä»¥å°† POST è¯·æ±‚æäº¤åˆ°æ‚¨çš„æ ¹åŸŸ (http://example.com)ï¼Œåˆ™ CloudFront ä¼šå°†è¯·æ±‚å‘é€åˆ° http://example.com/index.phpã€‚

    CloudFront é»˜è®¤æ ¹å¯¹è±¡çš„è¡Œä¸ºä¸ Amazon S3 ç´¢å¼•æ–‡æ¡£çš„è¡Œä¸ºä¸åŒã€‚å½“æ‚¨é…ç½® Amazon S3 å­˜å‚¨æ¡¶ä½œä¸ºç½‘ç«™å¹¶æŒ‡å®šç´¢å¼•æ–‡æ¡£æ—¶ï¼ŒAmazon S3 å°†è¿”å›ç´¢å¼•æ–‡æ¡£ï¼Œå³ä½¿ç”¨æˆ·è¯·æ±‚å­˜å‚¨æ¡¶ä¸­çš„å­ç›®å½•ã€‚ï¼ˆç´¢å¼•æ–‡æ¡£å‰¯æœ¬å¿…é¡»å‡ºç°åœ¨æ¯ä¸ªå­ç›®å½•ä¸­ã€‚ï¼‰ æœ‰å…³é…ç½® Amazon S3 å­˜å‚¨æ¡¶ä½œä¸ºç½‘ç«™ä»¥åŠç´¢å¼•æ–‡æ¡£çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚é˜… Amazon Simple Storage Service ç”¨æˆ·æŒ‡å—ä¸­çš„åœ¨ Amazon S3 ä¸Šæ‰˜ç®¡ç½‘ç«™ç« èŠ‚ã€‚
- S3ï¼š [é…ç½®ç´¢å¼•æ–‡æ¡£](https://docs.aws.amazon.com/zh_cn/AmazonS3/latest/userguide/IndexDocumentSupport.html)
    åœ¨ Amazon S3 ä¸­ï¼Œå­˜å‚¨æ¡¶æ˜¯å¯¹è±¡çš„å¹³é¢å®¹å™¨ã€‚å®ƒä¸ä¼šåƒè®¡ç®—æœºä¸Šçš„æ–‡ä»¶ç³»ç»Ÿé‚£æ ·æä¾›ä»»ä½•åˆ†å±‚ç»„ç»‡ã€‚ä½†æ˜¯ï¼Œæ‚¨å¯ä»¥é€šè¿‡ä½¿ç”¨è¡¨ç¤ºæ–‡ä»¶å¤¹ç»“æ„çš„å¯¹è±¡é”®ååˆ›å»ºé€»è¾‘å±‚çº§ç»“æ„ã€‚

    ä¾‹å¦‚ï¼Œè€ƒè™‘å…·æœ‰ä¸‰ä¸ªå¯¹è±¡ï¼ˆå…·æœ‰ä»¥ä¸‹é”®åï¼‰çš„å­˜å‚¨æ¡¶ã€‚è™½ç„¶å®ƒä»¬æ²¡æœ‰æŒ‰ä»»ä½•ç‰©ç†åˆ†å±‚ç»„ç»‡è¿›è¡Œå­˜å‚¨ï¼Œä½†æ‚¨å¯ä»¥ä»é”®åæ¨æ–­ä»¥ä¸‹é€»è¾‘æ–‡ä»¶å¤¹ç»“æ„ï¼š

    sample1.jpg â€” å¯¹è±¡ä½äºå­˜å‚¨æ¡¶çš„æ ¹çº§ã€‚

    photos/2006/Jan/sample2.jpg â€” å¯¹è±¡ä½äº photos/2006/Jan å­æ–‡ä»¶å¤¹ä¸­ã€‚

    photos/2006/Feb/sample3.jpg â€” å¯¹è±¡ä½äº photos/2006/Feb å­æ–‡ä»¶å¤¹ä¸­ã€‚

    åœ¨ Amazon S3 æ§åˆ¶å°ä¸­ï¼Œæ‚¨è¿˜å¯ä»¥åœ¨å­˜å‚¨æ¡¶ä¸­åˆ›å»ºæ–‡ä»¶å¤¹ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥åˆ›å»ºåä¸º photos çš„æ–‡ä»¶å¤¹ã€‚æ‚¨å¯ä»¥å°†å¯¹è±¡ä¸Šä¼ åˆ°å­˜å‚¨æ¡¶æˆ–è¯¥å­˜å‚¨æ¡¶ä¸­çš„ photos æ–‡ä»¶å¤¹ã€‚å¦‚æœæ‚¨å°†å¯¹è±¡ sample.jpg æ·»åŠ åˆ°å­˜å‚¨æ¡¶ï¼Œåˆ™é”®åä¸º sample.jpgã€‚å¦‚æœæ‚¨å°†å¯¹è±¡ä¸Šä¼ åˆ° photos æ–‡ä»¶å¤¹ï¼Œåˆ™å¯¹è±¡é”®åä¸º photos/sample.jpgã€‚

    å¦‚æœæ‚¨åœ¨å­˜å‚¨æ¡¶ä¸­åˆ›å»ºäº†æ–‡ä»¶å¤¹ç»“æ„ï¼Œåˆ™æ‚¨å¿…é¡»åœ¨æ¯ä¸ªçº§åˆ«ä¸Šéƒ½å…·æœ‰ç´¢å¼•æ–‡æ¡£ã€‚åœ¨æ¯ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œç´¢å¼•æ–‡æ¡£å¿…é¡»å…·æœ‰ç›¸åŒçš„åç§°ï¼Œä¾‹å¦‚ï¼Œindex.htmlã€‚å½“ç”¨æˆ·æŒ‡å®šç±»ä¼¼äºæ–‡ä»¶å¤¹æŸ¥æ‰¾çš„ URL æ—¶ï¼Œæ˜¯å¦å­˜åœ¨å°¾éƒ¨æ–œæ å°†å†³å®šç½‘ç«™çš„è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹å…·æœ‰å°¾éƒ¨åæ–œæ çš„ URL å°†è¿”å› photos/index.html ç´¢å¼•æ–‡æ¡£ã€‚
    ```
    http://bucket-name.s3-website.Region.amazonaws.com/photos/
    ```
    ä½†æ˜¯ï¼Œå¦‚æœæ‚¨ä»ä¹‹å‰çš„ URL æ’é™¤äº†å°¾éƒ¨æ–œæ ï¼Œåˆ™ Amazon S3 å°†é¦–å…ˆåœ¨å­˜å‚¨æ®µä¸­æŸ¥æ‰¾æ•°æ®å…ƒ photosã€‚å¦‚æœæœªæ‰¾åˆ° photos å¯¹è±¡ï¼Œå®ƒå°†æœç´¢ç´¢å¼•æ–‡æ¡£ photos/index.htmlã€‚å¦‚æœæ‰¾åˆ°è¯¥æ–‡æ¡£ï¼Œåˆ™ Amazon S3 å°†è¿”å› 302 Found æ¶ˆæ¯å¹¶æŒ‡å‘ photos/ å¯†é’¥ã€‚å¯¹äºå¯¹ photos/ çš„åç»­è¯·æ±‚ï¼ŒAmazon S3 å°†è¿”å› photos/index.htmlã€‚å¦‚æœæœªæ‰¾åˆ°ç´¢å¼•æ–‡æ¡£ï¼ŒAmazon S3 å°†è¿”å›é”™è¯¯ã€‚


# AWS
1. KMS: åˆ›å»º key
2. Secrets Manager: åˆ›å»ºå¯†é’¥
3. ACM: åˆ›å»ºè¯ä¹¦

helm bitnami kafka chart, åˆ›å»ºå¤–éƒ¨è®¿é—® + ELB + DNS

1. k8s é›†ç¾¤ä¸­ï¼Œéœ€è¦LBå»ºå¥½åæ‰èƒ½çŸ¥é“åœ°å€
2. Bitnami/chart/kafka é€šè¿‡å“¨å…µï¼Œè·å¾— lb åœ°å€ï¼Œ
3. ELB ä¸ DNS ç…§è€è·¯ç”¨ Annotation åˆ›å»º


### vscode memo
paste images
- install [vscode-paste-image](https://github.com/mushanshitiancai/vscode-paste-image)

    For pasting images from clipboard you can install and use vscode-paste-image. Thanks to VSCode Marketplace and the author of vscode-paste-image ğŸ’™.

    Example of settings.json for embedding images using `![[2020-08-12-20-11-46.png]]` format and saving them in Attachments folder automatically:

    ```json
    {
    "pasteImage.insertPattern": "![[${imageFileName}]]",
    "pasteImage.path": "${projectRoot}/Attachments"
    }
    ```

    After configuring vscode-paste-image extension, just copy some image and execute Paste image from the command palette and you are good to go ğŸ‘. You can create a shortcut for this command as well!

However, it could pastes, but configure failed.

Reason: another extension called hexo-utils using same command, with same effect as pasting image.
But that extension could not accept this config.
So, uninstall it, done.